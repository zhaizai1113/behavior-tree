行为树，英文是Behavior Tree，简称BT，是一棵用于**控制 AI **决策行为的、包含了层级节点的树结构。

当我们要决策当前这个士兵要做什么样的行为的时候，**我们就会自顶向下的，通过一些条件来搜索这颗树，最终确定需要做的行为（叶节点），并且执行它**，这就是行为树的基本原理。

树的最末端——叶子，就是这些 AI 实际上去做事情的命令；

### 叶子=命令

连接树叶的树枝，就是各种类型的修饰节点，这些节点决定了 AI 如何从树的顶端根据不同的情况，来沿着不同的路径来到最终的叶子这一过程。

### 树枝=节点

行为树的好处是：相对于用具体的命令去操控一个角色，行为树是利用节点之间的关联——>只需要抽象行为，不必理会战斗中具体发生的事情（个人理解为if else？）

<img src="C:\Users\86137\AppData\Roaming\Typora\typora-user-images\image-20201016004143444.png" alt="image-20201016004143444" style="zoom:50%;" />

ROOT是根节点，每次需要寻找行为的时候都必须从这里开始。

**Priority Selector**是一个逻辑节点，它的意思是让从左到右遍历自己的子节点，如果子节点的准入条件符合信息的话，就执行该子节点。如果英雄只看到哥布林，那么Orc in sight这个准入条件不符合，Escape不执行；Globlin in sight符合，于是执行Fight；因为Fight在Idle的左边，所以Fight的优先程度更高，于是Idle不执行。在我们的例子中，Idle可以看作是**default behavior**。

### 行为树的另一优点：reuse（重复使用）

Escape有一个跑（do run）的行为，而Fight则有跑（do run）的行为，和砍怪（do slash）的行为

<img src="C:\Users\86137\AppData\Roaming\Typora\typora-user-images\image-20201016004632879.png" alt="image-20201016004632879" style="zoom:50%;" />



**Sequence**同样是一个**逻辑节点**，它的意思是从**左到右**按顺序执行子节点，并且仅仅在一个子节点执行完成后才执行下一个子节点。在例子中，Do Run需要有一个自己判断到达目的地的方法，当该方法返回end的时候，才会执行Do Slash。

图中可见do run为重复行为，故do run 为可重复运用（reuse）的节点。

若想要在角色逃跑时，出现嘘声的音效。就会用到parallel（并行）

<img src="C:\Users\86137\AppData\Roaming\Typora\typora-user-images\image-20201016005039251.png" alt="image-20201016005039251" style="zoom:50%;" />

Parallel是一个逻辑节点，它的意思是让所有子节点**同时运行**，那它什么时候结束呢，可以使当所有子节点都完成的时候结束，也可以让任一子节点完成时结束，视乎需要来做出选择。

#### 目前为止的总结

1. 行为树拥有3种节点：

2. 1. **根节点** Root 			//根

   2. **逻辑节点**（可拓展）：         //茎

   3. 1. Priority Selector
      2. Sequence
      3. Parallel

   4. **行为节点**                     //叶

3. 行为树在复杂的情况比有限状态机更清晰，更可拓展

4. 行为树有利于**逻辑的重用**

5. 设计得好的行为树可以**千变万化！**

